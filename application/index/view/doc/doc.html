<!DOCTYPE html>
{__NOLAYOUT__}
{include file="public/header"/}


<!--内容区顶部导航-->
{include file="public/nav-doc"/}
{include file="public/left-nav"/}
<div class="container" style="margin-top: 80px">


    <div id="api-main">

        <div class="row">
            <div class="col-md-2">

                <!--<ul class="api-nav nav nav-pills nav-stacked">-->

                <!--{foreach $cate as $v}-->

                <!--<li data-id="{$v.cate_id}"><a href="#{$v.id}">{$v.name}</a></li>-->
                <!--{/foreach}-->
                <!--</ul>-->
                <nav class="hidden-print hidden-xs hidden-sm" id="accordion">

                    <ul class="nav api-left-nav">
                        {eq name="Request.session.user.role" value="2"}
                        <li>
                            <div class="left-nav-operate">
                                <a class="btn btn-primary btn-xs" id="add-api-cate-btn">添加分类</a>
                                <a href="__SITE__cate" class="btn btn-default btn-xs">管理分类</a>
                            </div>
                        </li>
                        {/eq}
                        {foreach $list as $v}
                        <li class="" data-id="{$v.cate_id}">
                            <a data-toggle="collapse" data-parent="#accordion"
                               href="#collapse{$v.cate_id}">{$v.name}</a>

                            <ul class="nav panel-collapse collapse in" id="collapse{$v.cate_id}">
                                {foreach $v.api as $va}
                                <li data-id="{$va.id}"><a href="javascript:void (0)">{$va.name}</a></li>
                                {/foreach}
                            </ul>

                        </li>
                        {/foreach}


                    </ul>

                </nav>
            </div>


            <div class="col-md-10">



                <div class="api-body">

                    <div class="api-body-header">
                        <h4>项目: <span>{$project}</span></h4>
                        <p>接口地址：<span id="current-site">http://{$site.0.site}</span></p>
                    </div>

                    {foreach $list as $vc}
                    {notempty name="vc.api"}

                    <!--<div class="mr_title text-center" id="tabs2-{$vc.cate_id}">-->
                        <!--<span class="mr_title_l"></span><span class="mr_title_c">{$vc.name}</span><span-->
                            <!--class="mr_title_r"></span>-->
                    <!--</div>-->


                    <ul class="api-doc-list">

                        {foreach $vc.api as $v}
                        <li id="tabs-{$v.id}">


                            <div class="api-list-title">
                                <div class="pull-left doc-list-cate"><h4>{$vc.name}</h4></div>
                                <h4 class="text-info pull-left">{$v.name}<span
                                        class="label api-status {switch name='v.status'}{case value='1'}label-info{/case}{case value='2'}label-success{/case}{case value='3'}label-danger{/case}{/switch}"
                                        data-id="{$v.id}">{$v.status_cn}</span></h4>
                                <a href="javascript:void (0);" class="edit-api pull-right" data-id="{$v.id}">编辑</a>
                                {eq name="Request.session.user.role" value="2"}
                                <a href="javascript:void (0);" class="delete-api pull-right" data-id="{$v.id}">删除</a>
                                {/eq}
                            </div>


                            <div class="row">
                                <div class="col-md-12">
                                    <h4 style="margin-bottom: 0" >请求</h4>
                                    <hr style="margin-top: 5px">

                                    <p>接口:<span class="api-name">{$v.api}</span> <span
                                            class="label label-success">{$v.type}</span></p>
                                </div>

                                <div class="col-md-12">
                                    <div class="api-user-card2">
                                        <div class="card2-img">
                                            <img src="__S__images/{$v.user.head_img}" class="img-circle" alt="">
                                        </div>

                                        <div class="card2-name">
                                            <p>{$v.user.username}</p>
                                            <p>
                                                <small>{$v.update_time}</small>
                                            </p>
                                        </div>
                                    </div>


                                </div>
                            </div>


                            <form class="doc-param">
                                <table class="table table-condensed">

                                    <thead>
                                    <tr>
                                        <th>参数名</th>
                                        <th>参数值</th>
                                        <th>参数说明</th>

                                    </tr>
                                    </thead>
                                    <tbody data-operate="add-api-tbody">


                                    {foreach $v.param as $vp}
                                    <tr class="input-param">
                                        <td><input type="text" name="param_key[]" class="form-control input-sm"
                                                   placeholder="请输入参数名" value="{$vp.name}"></td>
                                        <td><input type="text" name="param_value[]" class="form-control input-sm"
                                                   placeholder="请输入参数值" value="{$vp.value}"></td>
                                        <td><input type="text" name="param_comment[]" class="form-control input-sm"
                                                   placeholder="请输入参数说明" value="{$vp.comment}"></td>

                                    </tr>
                                    {/foreach}


                                    </tbody>
                                </table>
                            </form>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="api-go" data-operate="api-request"
                                         data-type="{$v.type}" data-api="{$v.api}" data-id="{$v.id}"><p>请求</p></div>
                                </div>
                            </div>


                            <h4 style="margin-bottom: 0">响应</h4>
                            <hr style="margin-top: 5px">
                            <div class="row">
                                <div class="col-md-12">

                                    <ul id="myTab{$v.id}" class="nav nav-pills">
                                        <li class="active">
                                            <a href="#success{$v.id}" data-toggle="pill">
                                                SUCCESS
                                            </a>

                                        </li>
                                        <li><a href="#error{$v.id}" data-toggle="pill">ERROR</a></li>
                                        <li class="pull-right">
                                            <a href="javascript:void (0);" data-operate="edit-json" data-type="error"
                                               data-id="{$v.id}"><span class="fa fa-edit (alias)"></span>error</a>
                                        </li>
                                        <li class="pull-right">
                                            <a href="javascript:void (0);" data-operate="edit-json" data-type="success"
                                               data-id="{$v.id}"><span class="fa fa-edit"></span>success</a>
                                        </li>

                                    </ul>


                                    <div id="myTab{$v.id}Content" class="tab-content">
                                        <div class="tab-pane fade in active" id="success{$v.id}">

                                            <div class="responsive-param" data-json="success{$v.id}">{$v.success}</div>
                                        </div>
                                        <div class="tab-pane fade" id="error{$v.id}">

                                            <div class="responsive-param" data-json="error{$v.id}">{$v.error}</div>
                                        </div>

                                    </div>

                                </div>


                                <div class="col-md-12" style="margin-top: 20px">
                                    {empty name="v.response"}
                                    <p>
                                        <a class="btn btn-default btn-xs" data-operate="edit-response-param" data-id="{$v.id}">添加响应参数说明</a>
                                    </p>
                                    {else/}
                                    <p>
                                        部分响应参数说明：<a class="btn btn-default btn-xs pull-right" data-operate="edit-response-param" data-id="{$v.id}">编辑</a>
                                    </p>
                                    <blockquote>
                                        <dl class="dl-horizontal" style="margin-bottom: 0">
                                            {foreach $v.response as $vr}
                                            <dt class="text-danger">{$vr.name}</dt>
                                            <dd>{$vr.comment}</dd>
                                            {/foreach}

                                        </dl>
                                    </blockquote>
                                    {/empty}

                                </div>


                            </div>


                            <div style="position: relative;margin: 5em 0">

                                <img src="__S__images/chatou.png" alt="" style="position: absolute;right: 0;top: -7px">
                                <hr style="border-top:1px dashed #aaa; height:1px;margin-right: 15px">
                            </div>


                        </li>
                        {/foreach}
                    </ul>
                    {/notempty}
                    {/foreach}
                </div>
            </div>
        </div>
        <footer class="footer " style="padding: 10px 0;display: none;border-top: solid 1px #dddddd;">
            <div class="container">
                <p class="text-muted" style="margin: 0">
                    <small><a href="http://www.topp123.com" target="_blank">MaMa-2016</a>&nbsp;&nbsp;|&nbsp;&nbsp;API调试助手2.0&nbsp;&nbsp;|&nbsp;&nbsp;使用帮助
                    </small>

                </p>
            </div>
        </footer>

    </div>

    <div class="float-nav hidden-xs">
        <ul>
            <li id="return-top"  data-title="返回顶部">
                <a href="javascript:void(0);"><i class="fa fa-angle-up"></i></a>>
            </li>

            <li  id="add-api" data-title="添加API">

                <a href="javascript:void(0);"><i class="fa fa-pencil-square"></i></a></li>
        </ul>
        <div><img src="__S__images/logo_small.png" class="img-responsive" alt=""></div>
    </div>

    <script>
        $(function () {
            $('.float-nav li').on('mouseenter mouseleave', function (event) {
                var $this = $(this);
                var id=$this.attr('id');
                var title=$this.attr('data-title');
                var alert = $this.children('.alert-nav');
                switch (event.type) {
                    case 'mouseenter':
                        layer.tips(title,'#'+id,{tips:[2, '#222']});
                        break;
                    case 'mouseleave':
                        var index = layer.tips();
                            layer.close(index);
                        break;
                }
            });

            $('.api-left-nav ul>li').on('click', function () {
                $('.api-left-nav ul>li>a').removeClass('active');
                $(this).children('a').addClass('active');

                var id = 'tabs-' + $(this).attr('data-id');
                var s_top = $('#' + id).offset().top - 100;
                $("body").animate({scrollTop: s_top});
            });

        });

    </script>
    <script src="__S__js/jquery.nicescroll.min.js"></script>
    <script type="text/javascript">
        $(function () {

            var $body = $('body');


            //site切换事件
            $('#site').on('change',function(){

                $('#current-site').html($(this).val());
            });

            //添加response参数
            $('[data-operate="edit-response-param"]').on('click', function () {



                var id=$(this).attr('data-id');




                $.post('__INDEX__doc/getResponseParam', {id: id}, function (msg) {
                    var str='';
                    if(msg.status==1){

                        var data=msg.content;

                        for(var key in data){
                            var tr='<tr class="response-param">' +
                                    '<td> <input type="text" name="response_param_key[]" class="form-control input-sm" placeholder="请输入参数名" value="'+data[key].name+'"></td>' +
                                    '<td> <input type="text" name="response_param_comment[]" class="form-control input-sm" placeholder="请输入参数说明" value="'+data[key].comment+'"></td>' +
                                    '<td> <a href="javascript:void (0);" class="btn btn-danger btn-sm" data-operate="delete-param" >删除</a></td>' +
                                    '</tr>';
                            str=str+tr;

                        }

                    }

                    var html = '<div class="form-edit-response-param" style="padding: 10px"><form class="form-horizontal" id="edit-response" role="form">' +
                            '<table class="table table-condensed">' +
                            '<thead>' +
                            '<tr>' +
                            '<th>参数名</th>' +
                            '<th>参数说明</th>' +
                            '<th> <a href="javascript:void (0);" id="add-response-param" class="btn btn-info btn-xs"><i class="fa fa-plus-square"></i>&nbsp;添加</a></th>' +
                            '</tr>' +
                            '</thead>' +
                            '<tbody id="response-tbody">' +str+
                            '</tbody>' +
                            '</table>' +
                            '</form></div>';
                    //页面层
                    layer.open({
                        type: 1,
                        title: '编辑响应参数',
                        skin: 'layui-layer-api', //加上边框
//                        closeBtn: 2, //不显示关闭按钮
                        shift: 1,
                        shadeClose: true, //开启遮罩关闭
                        area: ['800px', '558px'], //宽高
                        content: html,
                        btn: '保存',
                        yes: function (index, layero) {
                            var form = layero.find('form');

                            var fd=new FormData(form[0]);
                            fd.append('id',id);
                            $.ajax({
                               type:'post',
                                url:'__INDEX__doc/saveResponseParam',
                                data:fd,
                                dataType:'json',
                                success:function(msg){

                                    switch (msg.status) {
                                        case 1:

                                                layer.close(index);
                                            layer.msg(msg.content, {icon: 1});
                                            break;

                                    }
                                },
                                processData:false,
                                contentType:false
                            });

                        }
                    });


                });

            });

            //同步返回json数据到库
            var save_json, save_id;
            $body.on('click', '.save-response-param', function () {

                var type = $(this).attr('data-type');
                $.post('__INDEX__doc/saveResponseJson', {
                    list_id: save_id,
                    type: type,
                    json: save_json
                }, function (msg) {

                    switch (msg.status) {
                        case 1:
                            $('#myModal').modal('hide');
                            layer.msg(msg.content, {icon: 1});
                            break;

                    }
                });
            });

            //编辑响应参数json
            $body.on('click', '[data-operate="edit-json"]', function () {

                var id = $(this).attr('data-id');
                var type = $(this).attr('data-type');
                $.post('__INDEX__doc/editJson', {id: id, type: type}, function (msg) {
                    if (msg) {
                        var html = JSON.stringify(JSON.parse(msg), null, 8); // 缩进一个tab
                    } else {
                        var html = '';
                    }


                    //页面层
                    layer.open({
                        type: 1,
                        title: '编辑响应数据',
                        skin: 'layui-layer-api', //加上边框
//                        closeBtn: 2, //不显示关闭按钮
                        shift: 3,
                        shadeClose: true, //开启遮罩关闭
                        area: ['800px', '558px'], //宽高
                        content: '<div  class="api-doc-edit"><textarea name="" class="form-control" id="" cols="30" rows="22" >' + html + '</textarea>' +
                        '</div>',
                        btn: '保存',
                        yes: function (index, layero) {
                            var json = layero.find('textarea').val();
                            $.post('__INDEX__doc/saveResponseJson', {
                                list_id: id,
                                type: type,
                                json: json
                            }, function (res) {
                                layer.close(index);
                                switch (res.status) {
                                    case 1:

                                        layer.msg(res.content, {icon: 1});
                                        break;

                                }

                            });
                        }
                    });

                });

            });

            //格式化全局json
            $('.responsive-param').each(function () {
                var str = $(this).text();
                if (str) {
                    var data_json = $(this).attr('data-json');
                    var options = {
                        dom: '[data-json="' + data_json + '"]' //对应容器的css选择器
                    };
                    var jf = new JsonFormater(options); //创建对象
                    var json_responsive = JSON.parse(str);
                    jf.doFormat(json_responsive); //格式化json
                }
            });

            //美化导航条
            $(".api-left-nav").niceScroll({
                cursorborder: "#ffffff",
                cursorcolor: "#5FB878",
                cursorwidth: "1px",
                zindex: 1,
                boxzoom: false,
                horizrailenabled: true//禁止水平滚动
            });

            /**
             *移动目录
             *add by zk 2016/8/15 17:08
             */
            $('.api-left-nav').sortable({
                cursor: "move",
                items: ">li", //只是li可以拖动
                opacity: 0.6, //拖动时，透明度为0.6
                revert: true, //释放时，增加动画
                update: function (event, ui) { //更新排序之后
                    var arr = [];
                    $('.api-left-nav>li').each(function () {
                        arr.push($(this).attr('data-id'));
                    });
                    $.post('__INDEX__doc/updateDirOrder', {id: JSON.stringify(arr)}, function () {

                    });
                }
            });

            //初始化placeholder
            $('.request-param-input').each(function () {
                var $this = $(this);
                var p = $this.attr('placeholder');

                var len = p.length;
                var ss = p.substring(0, len - 1);
                $this.attr('placeholder', ss);
            });
            var $api_body = $('.api-body');
            //更新状态
            $api_body.on('click', '.api-status', function () {
                var $this = $(this);
                $.post('__INDEX__doc/updateStatus', {id: $(this).attr('data-id')}, function (msg) {

                    if (msg.status == 1) {
                        switch (msg.content) {
                            case 2:
                                $this.removeClass('label-info');
                                $this.removeClass('label-danger');
                                $this.addClass('label-success');
                                $this.html('已完成');
                                console.log(2);
                                break;
                            case 3:
                                $this.removeClass('label-success');
                                $this.addClass('label-danger');
                                $this.html('修改中');
                                console.log(3);
                                break;
                        }
                    }
                });
            });

            //删除参数
            $body.on('click', '[data-operate="delete-param"]', function () {

                $(this).parent().parent().remove();
            });

            //添加参数
            $body.on('click', '#add-param', function () {


                var $tr = $(' <tr class="input-param">' +
                        '<td> <input type="text" name="param_key[]" class="form-control input-sm" placeholder="请输入参数名"></td>' +
                        '<td> <input type="text" name="param_value[]" class="form-control input-sm" placeholder="请输入参数值"></td>' +
                        '<td> <input type="text" name="param_comment[]" class="form-control input-sm" placeholder="请输入参数说明"></td>' +
                        '<td> <a href="javascript:void (0);" class="btn btn-danger btn-sm" data-operate="delete-param" >删除</a></td>' +
                        '</tr>');
                $('#add-api-tbody').append($tr);
            });
            //添加响应注释参数
            $body.on('click','#add-response-param',function(){

                var tr = $('<tr class="response-param">' +
                        '<td> <input type="text" name="response_param_key[]" class="form-control input-sm" placeholder="请输入参数名"></td>' +
                        '<td> <input type="text" name="response_param_comment[]" class="form-control input-sm" placeholder="请输入参数说明"></td>' +
                        '<td> <a href="javascript:void (0);" class="btn btn-danger btn-sm" data-operate="delete-param" >删除</a></td>' +
                        '</tr>');
                $('#response-tbody').append(tr);
            });

            //提交添加site
            $('#add-api-site-submit').on('click', function () {

                $.post('__INDEX__doc/saveSite', {
                    site: $('#api-site-name').val(),
                    project: $('#api-site-project').val()
                }, function (msg) {
                    if (msg.status == 1) {

                        var alert = $('<div class="alert-div"><div class="alert alert-success">保存根地址成功</div></div>');
                        $('body').prepend(alert);
                        alert.fadeIn("slow");
                        setTimeout(function () {
                                    alert.fadeOut("slow");
                                    setTimeout(function () {
                                                alert.remove();

                                            },
                                            2000);
                                    api_site_modal.modal('hide');
                                    window.location.reload();
                                },
                                2000);
                    }
                });
            });

            //跳转到顶部
            $('#return-top').on('click', function () {
                $("body").animate({scrollTop: 0});
            });



            //提交添加api
            $body.on('click', '#add-api-submit', function () {
                var fd = new FormData($('#add-api-form')[0]);
                $.ajax({
                    url: '__INDEX__doc/addApi',
                    type: 'post',
                    data: fd,
                    dataType: 'json',
                    success: function (msg) {
                        if (msg.status == 1) {
                            layer.msg(msg.content, {icon: 1});
                            $('.layui-layer-close').trigger('click');
//                            window.location.reload();
                        }

                    },
                    processData: false,
                    contentType: false
                });

            });

            //footer:margin-top
            var $prevDiv = $("#api-main");
            var $footer = $("footer");
            var all = $(window).height();//是文档窗口高度
            var top = $prevDiv.offset().top;//是标签距离顶部高度
            var scroll = $(document).scrollTop();//是滚动条高度
            var height = $prevDiv.height();//是标签高度
            var f = $footer.height();
            //你要的高度
            var margin_top = all - height - (top - scroll) - f - 20;
            if (margin_top > 0) {
                $footer.css('margin-top', margin_top);
            } else {
                $footer.css('margin-top', '10px');
            }
            $footer.fadeIn("slow");

            //添加api按钮

            $('#add-api').on('click', function () {
                $.post('__INDEX__doc/getCate', {project_id: '{$Request.param.id}'}, function (msg) {

                    if (msg.status == 1) {
                        var str = '';
                        var data = msg.content;
                        for (var key in data) {
                            var option = '<option value="' + data[key].cate_id + '">' + data[key].name + '</option>';
                            str = str + option;
                        }

                        var html = '<div class="api-doc-add-api"><form class="form-horizontal" id="add-api-form" role="form">' + '<div class="form-group form-group-sm">' +
                                '<label  class="col-sm-2 control-label">请求方式</label>' +
                                '<div class="col-sm-10">' +
                                ' <label class="checkbox-inline">' +
                                '<input type="radio" name="type" value="post" checked>POST</label>' +
                                '<label class="checkbox-inline">' +
                                '<input type="radio" name="type" value="get">GET</label>' +
                                '</div>' +
                                '</div>' +
                                '<div class="form-group form-group-sm">' +
                                '<label  class="col-sm-2 control-label">类别</label>' +
                                '<div class="col-sm-10">' +
                                '<select name="cate_id"   class="form-control">' + str + '</select>' +
                                '</div>' +
                                '</div>' +

                                '<div class="form-group form-group-sm">' +
                                '<label  class="col-sm-2 control-label">api名称</label>' +
                                '<div class="col-sm-10">' +
                                '<input type="text" class="form-control" name="name" placeholder="请输入api名称">' +
                                '</div>' +
                                '</div>' +
                                '<div class="form-group form-group-sm">' +
                                ' <label class="col-sm-2 control-label">api</label>' +
                                '<div class="col-sm-10">' +
                                '<input type="text" class="form-control" name="api" placeholder="请输入主接口后面的接口参数">' +
                                '</div>' +
                                '</div>' +
                                '<div class="form-group form-group-sm">' +
                                '<label  class="col-sm-2 control-label">默认请求参数</label>' +
                                '<div class="col-sm-10">' +
                                '<table class="table table-condensed">' +
                                '<thead>' +
                                '<tr>' +
                                '<th>参数名</th>' +
                                '<th>参数值</th>' +
                                '<th>参数说明</th>' +
                                '<th> <a href="javascript:void (0);" id="add-param" class="btn btn-info btn-xs"><i class="fa fa-plus-square"></i>&nbsp;添加</a></th>' +
                                '</tr>' +
                                '</thead>' +
                                '<tbody id="add-api-tbody">' +
                                '</tbody>' +
                                '</table>' +
                                '</div>' +
                                '</div>' +
                                '<div class="form-group">' +
                                '<div class="col-sm-offset-2 col-sm-10">' +
                                '<a href="javascript:void (0);" id="add-api-submit" class="btn btn-success btn-block">添加</a>' +
                                '</div>' +
                                '</div>' +
                                '</form></div>';
                        //页面层
                        layer.open({
                            type: 1,
                            title: '添加API',
                            skin: 'layui-layer-api', //加上边框
                            shift:1,
                            shadeClose:true,
                            area: ['850px', '580px'], //宽高
                            content: html
                        });
                    }

                });

            });

//        api_modal.on('hidden.bs.modal', function (e) {
//            window.location.reload();
//        });

            //编辑api按钮
            var api_id;

            $api_body.on('click', '.edit-api', function () {
                var id = $(this).attr('data-id');
                $.post('__INDEX__doc/getApi', {id: id, project_id: '{$Request.param.id}'}, function (msg) {
                    var str = '';
                    var data = msg.cate;
                    var api = msg.api;

                    for (var key in data) {

                        var selected = api.cate_id == data[key].cate_id ? 'selected' : '';
                        var option = '<option value="' + data[key].cate_id + '" ' + selected + '>' + data[key].name + '</option>';
                        str = str + option;
                    }

                    //拼接参数
                    var param = api.param;
                    if (param) {
                        var trs = '';
                        for (var key in param) {
                            var tr = ' <tr class="input-param">' +
                                    '<td> <input type="text" name="param_key[]" class="form-control input-sm" placeholder="请输入参数名" value="' + param[key].name + '"></td>' +
                                    '<td> <input type="text" name="param_value[]" class="form-control input-sm" placeholder="请输入参数值" value="' + param[key].value + '"></td>' +
                                    '<td> <input type="text" name="param_comment[]" class="form-control input-sm" placeholder="请输入参数说明" value="' + param[key].comment + '"></td>' +
                                    '<td> <a href="javascript:void (0);" class="btn btn-danger btn-sm" data-operate="delete-param" >删除</a></td>' +
                                    '</tr>';
                            trs = trs + tr;
                        }
                    }

                    var html = '<div class="api-doc-add-api"><form class="form-horizontal" id="add-api-form" role="form">' +
                            '<div class="form-group form-group-sm">' +
                            '<label  class="col-sm-2 control-label">请求方式</label>' +
                            '<div class="col-sm-10">' +
                            ' <label class="checkbox-inline">' +
                            '<input type="radio" name="type" value="post" checked>POST</label>' +
                            '<label class="checkbox-inline">' +
                            '<input type="radio" name="type" value="get">GET</label>' +
                            '</div>' +
                            '</div>' +
                            '<div class="form-group form-group-sm">' +
                            '<label  class="col-sm-2 control-label">类别</label>' +
                            '<div class="col-sm-10">' +
                            '<select name="cate_id"   class="form-control">' + str + '</select>' +
                            '</div>' +
                            '</div>' +
                            '<div class="form-group form-group-sm">' +
                            '<label  class="col-sm-2 control-label">api名称</label>' +
                            '<div class="col-sm-10">' +
                            '<input type="text" class="form-control" name="name" placeholder="请输入api名称" value="' + api.name + '" >' +
                            '<input type="hidden"  name="id" value="' + api.id + '">' +
                            '</div>' +
                            '</div>' +
                            '<div class="form-group form-group-sm">' +
                            ' <label class="col-sm-2 control-label">api</label>' +
                            '<div class="col-sm-10">' +
                            '<input type="text" class="form-control" name="api" placeholder="请输入主接口后面的接口参数" value="' + api.api + '">' +
                            '</div>' +
                            '</div>' +
                            '<div class="form-group form-group-sm">' +
                            '<label  class="col-sm-2 control-label">默认请求参数</label>' +
                            '<div class="col-sm-10">' +
                            '<table class="table table-condensed">' +
                            '<thead>' +
                            '<tr>' +
                            '<th>参数名</th>' +
                            '<th>参数值</th>' +
                            '<th>参数说明</th>' +
                            '<th> <a href="javascript:void (0);" id="add-param" class="btn btn-info btn-xs"><i class="fa fa-plus-square"></i>&nbsp;添加</a></th>' +
                            '</tr>' +
                            '</thead>' +
                            '<tbody id="add-api-tbody">' + trs +
                            '</tbody>' +
                            '</table>' +
                            '</div>' +
                            '</div>' +
                            '<div class="form-group">' +
                            '<div class="col-sm-offset-2 col-sm-10">' +
                            '<a href="javascript:void (0);" id="add-api-submit" class="btn btn-success btn-block">保存</a>' +
                            '</div>' +
                            '</div>' +
                            '</form></div>';
                    //页面层
                    layer.open({
                        type: 1,
                        title: '编辑API',
                        skin: 'layui-layer-api', //加上边框
                        shift:3,
                        shadeClose:true,
                        area: ['850px', '580px'], //宽高
                        content: html
                    });

                });
            });
            //删除api按钮
            var $alert = $('#alert-modal'), $current_audit;
            $api_body.on('click', '.delete-api', function () {

                var $this = $(this);
                var id = $this.attr('data-id');
                //询问框
                layer.confirm('确认删除？', {
                    title: '操作提示',
                    btn: ['确认', '取消'] //按钮
                }, function () {
                    $.post('__INDEX__doc/deleteApi', {id: id}, function (msg) {
                        if (msg.status == 1) {
                            layer.msg('删除成功', {
                                time: 5000, //20s后自动关闭
                                btn: ['悲伤不？', '我看这条api不爽很久了']
                            });
                            $this.parent().parent().remove();
                        }
                    });
                });
            });

            //添加api-cate按钮

            $('#add-api-cate-btn').on('click', function () {

                var html = '<div style="width: 300px;margin: 20px 20px 10px 20px"><input type="text" class="form-control" id="api-cate-name" placeholder="请输入分类名称"></div>';



                //页面层
                layer.open({
                    type: 1,
                    title: '添加分类',
                    skin: 'layui-layer-api', //加上边框
                    shift:3,
                    btn:'添加',
                    shadeClose:true,
                    area: ['340px', '160px'], //宽高
                    content: html,
                    yes:function(index,msgInfo){
                        $.post('__INDEX__doc/addCate', {
                            name: msgInfo.find('input').val(),
                            project_id: '{$Request.param.id}'
                        }, function (msg) {
                            if (msg.status == 1) {
                                layer.close(index);
                                layer.msg('添加成功',{icon:1});
                            }
                        });
                    }
                });
            });
            //添加api-site按钮
            var api_site_modal = $('#add-api-site');
            $('#add-api-site-btn').on('click', function () {

                api_site_modal.modal();
            });

            //go
            $('.api-body').on('click', '[data-operate="api-request"]', function () {
                var $this = $(this);
                save_id = $this.attr('data-id');
                var $form = $this.parents('.row').prev();
                var type = $this.attr('data-type');
                var api = $this.attr('data-api');
                var fd = new FormData($form[0]);

                fd.append('site', $('#site').val());

                fd.append('type', type);
                fd.append('api', api);

                $.ajax({
                    url: '__INDEX__doc/ajaxJson',
                    type: 'post',
                    data: fd,
                    dataType: 'json',
                    success: function (msg) {
                        console.log(typeof(msg));

                        try {
                            //在此运行代码
                            var r_msg = JSON.parse(msg);
                            if (typeof(r_msg) == 'object') {
                                console.log(1);
                                save_json = r_msg;
                                $('.json>textarea').empty().append(msg);
                                var options = {
                                    dom: '.json' //对应容器的css选择器
                                };
                                var jf = new JsonFormater(options); //创建对象
                                jf.doFormat(msg); //格式化json
                                $('#myModal').modal();
                            } else {
                                //在此处理错误
                                console.log(2);
                                layer.open({
                                    type: 2,
                                    title: '非json对象信息',
                                    shadeClose: true,
                                    shade: 0.5,
                                    area: ['80%', '90%'],
                                    content: '__INDEX__doc/bug' //iframe的url
                                });
                            }
                        }
                        catch (err) {

                            console.log(3);
                            //在此处理错误
                            layer.open({
                                type: 2,
                                title: '错误信息',
                                shadeClose: true,
                                shade: 0.5,
                                area: ['80%', '90%'],
                                content: '__INDEX__doc/bug' //iframe的url
                            });
                        }

                    },
                    error: function (msg) {
                        //在此处理错误
                        console.log(4);
                        layer.open({
                            type: 2,
                            title: '错误信息',
                            shadeClose: true,
                            shade: 0.5,
                            area: ['80%', '90%'],
                            content: '__INDEX__doc/bug' //iframe的url
                        });
                    },

                    processData: false,
                    contentType: false
                });

            });

            $('#error-modal').on('hidden.bs.modal', function (e) {

                document.getElementById('#error-modal').html('');

            });


        });
    </script>


</div>
<!--内容区底部-->
{include file="public/modal"/}


{include file="public/footer"/}